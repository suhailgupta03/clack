<html>
    <head>
        <title>Get Clacked</title>
    </head>
    
    <body>
        <h3 class="center">Clack - The Socket Server</h3>
        <h4>Elvis</h4>
        <h5 id="connection_state"></h5>
        <textarea class="message_box" rows="10" cols="20"></textarea>
        
        <p class="messages_received">
            
        </p>
        
        <script type="text/javascript">
            var socketAddress = "192.168.0.222:3001";
            var ws = new WebSocket("ws://" + socketAddress);
            
            ws.onopen = function() {
                document.getElementById("connection_state").innerHTML = "You are connected";
                // Send the username when user is connected
                // This is required to attach the username to the server socket
                ws.send(JSON.stringify({"username" : "Elvis"}));
            }
            
            ws.onclose = function() {
                document.getElementById("connection_state").innerHTML = "Disconnected";
            }
            
            ws.onmessage = function(payload) {
                var child = "<p>&#9787;&nbsp;" + payload.data + "</p>";
                document.getElementsByClassName("messages_received")[0].innerHTML += child;
            }
            
            ws.onerror = function(message) {
                 document.getElementById("connection_state").innerHTML = "Error occured while trying to connect " + socketAddress;
            }
            
            document.getElementsByClassName("message_box")[0].onkeypress = function(event) {
                if(event.keyCode == 13) {
                    ws.send(this.value);
                    this.value = "";
                }
            }
        </script>
    </body>
</html>